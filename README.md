# æ™ºèƒ½ä½“æœåŠ¡å¹³å°

åŸºäºŽ LangChain v0.3 + LangGraph æž„å»ºçš„æ™ºèƒ½ä½“æœåŠ¡å¹³å°ï¼Œä¸ºå°å•†å®¶æä¾›å°çº¢ä¹¦çˆ†æ¬¾ã€æœ‹å‹åœˆç”Ÿæˆç­‰æ™ºèƒ½ä½“æœåŠ¡ã€‚

## ðŸŒŸ ç‰¹æ€§

- **å¤šæ™ºèƒ½ä½“æ”¯æŒ**: å°çº¢ä¹¦çˆ†æ¬¾æ™ºèƒ½ä½“ã€æœ‹å‹åœˆç”Ÿæˆæ™ºèƒ½ä½“ç­‰
- **å›½äº§æ¨¡åž‹é›†æˆ**: æ”¯æŒç™¾åº¦æ–‡å¿ƒä¸€è¨€ã€é˜¿é‡Œé€šä¹‰åƒé—®ã€è…¾è®¯æ··å…ƒç­‰
- **çµæ´»æž¶æž„**: åŸºäºŽ LangGraph çš„æ™ºèƒ½ä½“å·¥ä½œæµ
- **é«˜æ€§èƒ½**: FastAPI + å¼‚æ­¥å¤„ç†ï¼Œæ”¯æŒé«˜å¹¶å‘
- **ä¼ä¸šçº§**: å®Œå–„çš„æ—¥å¿—ã€ç›‘æŽ§ã€å¼‚å¸¸å¤„ç†ç³»ç»Ÿ
- **çŽ°ä»£åŒ–å·¥å…·**: ä½¿ç”¨ uv è¿›è¡Œå¿«é€Ÿä¾èµ–ç®¡ç†
- **æ˜“éƒ¨ç½²**: Docker å®¹å™¨åŒ–éƒ¨ç½²

## ðŸ—ï¸ æŠ€æœ¯æž¶æž„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **åŽç«¯æ¡†æž¶**: FastAPI 0.104+
- **æ™ºèƒ½ä½“æ¡†æž¶**: LangChain 0.3 + LangGraph 0.2
- **æ•°æ®åº“**: SQLite (å¼€å‘) / PostgreSQL (ç”Ÿäº§)
- **æ¨¡åž‹é›†æˆ**: æ™ºè°±AI GLM-4ã€ç™¾åº¦æ–‡å¿ƒä¸€è¨€ã€é˜¿é‡Œé€šä¹‰åƒé—®
- **ä¾èµ–ç®¡ç†**: uv (å¿«é€ŸPythonåŒ…ç®¡ç†å™¨)
- **å®¹å™¨åŒ–**: Docker + Docker Compose

### é¡¹ç›®ç»“æž„
```
app/
â”œâ”€â”€ agents/          # æ™ºèƒ½ä½“å®žçŽ°
â”‚   â”œâ”€â”€ core/        # æ ¸å¿ƒåŸºç±»å’ŒæŽ¥å£
â”‚   â”œâ”€â”€ factories/   # æ™ºèƒ½ä½“å·¥åŽ‚
â”‚   â””â”€â”€ implementations/  # å…·ä½“æ™ºèƒ½ä½“å®žçŽ°
â”œâ”€â”€ api/             # APIè·¯ç”±
â”œâ”€â”€ core/            # æ ¸å¿ƒé…ç½®å’Œå·¥å…·
â”œâ”€â”€ database/        # æ•°æ®åº“ç›¸å…³
â”œâ”€â”€ models/          # æ¨¡åž‹é€‚é…å™¨
â””â”€â”€ prompts/         # æç¤ºè¯ç®¡ç†
```

## ðŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Python**: 3.8+
- **uv**: çŽ°ä»£åŒ–çš„PythonåŒ…ç®¡ç†å™¨ (æŽ¨è)
- **Git**: ç‰ˆæœ¬æŽ§åˆ¶å·¥å…·

### 1. çŽ¯å¢ƒå‡†å¤‡

```bash
# å®‰è£… uv (å¦‚æžœå°šæœªå®‰è£…)
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh
# Windows
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"

# å…‹éš†é¡¹ç›®
git clone https://github.com/TaoPeiLing/AaaS-Backend.git
cd AaaS-Backend

# ä½¿ç”¨ uv åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒå¹¶å®‰è£…ä¾èµ–
uv venv
uv pip install -r requirements.txt
```

### 2. é…ç½®çŽ¯å¢ƒ

```bash
# å¤åˆ¶çŽ¯å¢ƒé…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®APIå¯†é’¥
# è‡³å°‘éœ€è¦é…ç½®ä¸€ä¸ªæ¨¡åž‹æä¾›å•†çš„APIå¯†é’¥
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# æŽ¨èæ–¹å¼ï¼šä½¿ç”¨ uv run ç›´æŽ¥è¿è¡Œï¼ˆè‡ªåŠ¨ä½¿ç”¨è™šæ‹ŸçŽ¯å¢ƒï¼‰
uv run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# ä½¿ç”¨ Docker Compose
docker-compose up -d
```

### 4. è®¿é—®æœåŠ¡

- **APIæ–‡æ¡£**: http://localhost:8000/api/v1/docs
- **å¥åº·æ£€æŸ¥**: http://localhost:8000/health
- **æ ¹è·¯å¾„**: http://localhost:8000/

## ðŸ“– API ä½¿ç”¨æŒ‡å—

### æ™ºèƒ½ä½“ç®¡ç†

#### èŽ·å–æ™ºèƒ½ä½“ç±»åž‹
```bash
curl -X GET "http://localhost:8000/api/v1/agents/types"
```

#### å°çº¢ä¹¦å†…å®¹ç”Ÿæˆ
```bash
curl -X POST "http://localhost:8000/api/v1/agents/xiaohongshu/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "æŠ¤è‚¤å“",
    "style": "ç§è‰",
    "target_audience": "å¹´è½»å¥³æ€§",
    "keywords": ["å¹³ä»·", "å¥½ç”¨", "å­¦ç”Ÿå…š"],
    "length": "ä¸­ç­‰"
  }'
```

#### æœ‹å‹åœˆå†…å®¹ç”Ÿæˆ
```bash
curl -X POST "http://localhost:8000/api/v1/agents/wechat-moments/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "content_type": "ç¾Žé£ŸæŽ¨è",
    "main_content": "ä»Šå¤©åŽ»äº†ä¸€å®¶æ–°å¼€çš„å·èœé¦†ï¼Œå‘³é“å¾ˆä¸é”™",
    "tone": "è½»æ¾",
    "include_emoji": true,
    "length": "é€‚ä¸­"
  }'
```

## ðŸ”§ é…ç½®è¯´æ˜Ž

### çŽ¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜Ž | é»˜è®¤å€¼ |
|--------|------|--------|
| `ENVIRONMENT` | è¿è¡ŒçŽ¯å¢ƒ | `development` |
| `DATABASE_URL` | æ•°æ®åº“è¿žæŽ¥URL | `sqlite:///./agent_platform.db` |
| `ZHIPUAI_API_KEY` | æ™ºè°±AI APIå¯†é’¥ | - |
| `BAIDU_API_KEY` | ç™¾åº¦APIå¯†é’¥ | - |
| `DASHSCOPE_API_KEY` | é˜¿é‡ŒAPIå¯†é’¥ | - |

### æ¨¡åž‹æä¾›å•†é…ç½®

æ”¯æŒçš„æ¨¡åž‹æä¾›å•†ï¼š

1. **æ™ºè°±AI GLM-4**
   - éœ€è¦é…ç½®: `ZHIPUAI_API_KEY`
   - æ”¯æŒæ¨¡åž‹: `glm-4`, `glm-4v`

2. **ç™¾åº¦æ–‡å¿ƒä¸€è¨€**
   - éœ€è¦é…ç½®: `BAIDU_API_KEY`, `BAIDU_SECRET_KEY`
   - æ”¯æŒæ¨¡åž‹: `ernie-3.5-turbo`, `ernie-4.0-turbo`

3. **é˜¿é‡Œé€šä¹‰åƒé—®**
   - éœ€è¦é…ç½®: `DASHSCOPE_API_KEY`
   - æ”¯æŒæ¨¡åž‹: `qwen-turbo`, `qwen-plus`, `qwen-max`

## ðŸ¢ ç”Ÿäº§éƒ¨ç½²

### Docker éƒ¨ç½²

```bash
# æž„å»ºé•œåƒ
docker build -t aaas-backend .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name aaas-backend \
  -p 8000:8000 \
  -e ENVIRONMENT=production \
  -e ZHIPUAI_API_KEY=your_key \
  -v $(pwd)/data:/app/data \
  aaas-backend
```

### Docker Compose éƒ¨ç½²

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

## ðŸ§ª å¼€å‘æŒ‡å—

### å¼€å‘çŽ¯å¢ƒè®¾ç½®

```bash
# ä½¿ç”¨ uv è¿›è¡Œå¼€å‘çŽ¯å¢ƒè®¾ç½®
uv venv --python 3.11  # æŒ‡å®šPythonç‰ˆæœ¬åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
uv pip install -r requirements.txt

# å®‰è£…å¼€å‘ä¾èµ–
uv pip install pytest black isort mypy

# ä½¿ç”¨ uv run è¿è¡Œå¼€å‘å·¥å…·ï¼ˆè‡ªåŠ¨ä½¿ç”¨è™šæ‹ŸçŽ¯å¢ƒï¼‰
uv run black app/      # ä»£ç æ ¼å¼åŒ–
uv run isort app/      # å¯¼å…¥æŽ’åº
uv run mypy app/       # ç±»åž‹æ£€æŸ¥
uv run pytest         # è¿è¡Œæµ‹è¯•
```

### æ·»åŠ æ–°çš„æ™ºèƒ½ä½“

1. ç»§æ‰¿ `BaseAgent` ç±»
2. å®žçŽ°å¿…è¦çš„æŠ½è±¡æ–¹æ³•
3. åœ¨å·¥åŽ‚ä¸­æ³¨å†Œæ™ºèƒ½ä½“ç±»åž‹
4. æ·»åŠ å¯¹åº”çš„APIæŽ¥å£

### æ·»åŠ æ–°çš„æ¨¡åž‹æä¾›å•†

1. ç»§æ‰¿ `ModelAdapter` ç±»
2. å®žçŽ°APIè°ƒç”¨é€»è¾‘
3. åœ¨å·¥åŽ‚ä¸­æ³¨å†Œé€‚é…å™¨
4. æ›´æ–°é…ç½®æ–‡ä»¶

## ðŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. å…‹éš†åˆ°æœ¬åœ°å¹¶è®¾ç½®å¼€å‘çŽ¯å¢ƒ
3. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
4. è¿›è¡Œæ›´æ”¹å¹¶ç¡®ä¿ä»£ç è´¨é‡
5. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
6. æŽ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
7. åˆ›å»º Pull Request

## ðŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ðŸ”„ æ›´æ–°æ—¥å¿—

### v1.1.0 (2024-12-25) - LangChain 0.3 å…¼å®¹æ€§å‡çº§

#### ðŸ”„ é‡å¤§å˜æ›´
- **LangGraph API æ›´æ–°**: æ›¿æ¢åºŸå¼ƒçš„ `END` å¸¸é‡ä¸º `"__end__"` å­—ç¬¦ä¸²
- **æ¨¡åž‹è°ƒç”¨APIå‡çº§**: å°† `agenerate` æ–¹æ³•æ›¿æ¢ä¸º `ainvoke`
- **æµå¼è°ƒç”¨ä¼˜åŒ–**: ä¿®å¤ `astream` æ–¹æ³•çš„å‚æ•°ä¼ é€’æ–¹å¼

#### âœ¨ æ–°å¢žåŠŸèƒ½
- **å¢žå¼ºé”™è¯¯å¤„ç†**: æ·»åŠ å®Œæ•´çš„å¼‚å¸¸å¤„ç†å’Œç»“æž„åŒ–æ—¥å¿—
- **Tokenç»Ÿè®¡æ”¹è¿›**: æ”¯æŒæ–°çš„ `usage_metadata` æ ¼å¼
- **å…¼å®¹æ€§æµ‹è¯•**: æ–°å¢ž LangChain 0.3 å…¼å®¹æ€§éªŒè¯

#### ðŸ”§ æŠ€æœ¯æ”¹è¿›
- **ä¾èµ–ç‰ˆæœ¬ä¼˜åŒ–**: æ›´æ–° LangGraph ç‰ˆæœ¬èŒƒå›´ä¸º `>=0.2.20,<0.3.0`
- **ç±»åž‹æ³¨è§£å¢žå¼º**: æ”¹è¿›ç±»åž‹æç¤ºå’Œä»£ç è´¨é‡
- **CI/CDé›†æˆ**: æ·»åŠ è‡ªåŠ¨åŒ–å…¼å®¹æ€§æ£€æŸ¥

### v1.0.0 (2024-01-XX)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒå°çº¢ä¹¦å’Œæœ‹å‹åœˆæ™ºèƒ½ä½“
- é›†æˆæ™ºè°±AI GLM-4
- å®Œæ•´çš„APIæŽ¥å£å’Œæ–‡æ¡£